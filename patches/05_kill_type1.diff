From 13949f997289068354e83bc83e50d97b8232efb1 Mon Sep 17 00:00:00 2001
From: Julien Cristau <jcristau@debian.org>
Date: Thu, 23 Aug 2007 11:27:33 +0200
Subject: [PATCH] Get rid of the type1 font module.

It is completely replaced by freetype these days.
---
 hw/xfree86/common/xf86AutoConfig.c   |    1 -
 hw/xfree86/common/xf86Config.c       |    1 -
 hw/xfree86/dixmods/Makefile.am       |    6 +--
 hw/xfree86/dixmods/type1mod.c        |   75 ----------------------------------
 hw/xfree86/doc/man/xorg.conf.man.pre |    4 +-
 5 files changed, 3 insertions(+), 84 deletions(-)
 delete mode 100644 hw/xfree86/dixmods/type1mod.c

Index: xorg-server/hw/xfree86/common/xf86AutoConfig.c
===================================================================
--- xorg-server.orig/hw/xfree86/common/xf86AutoConfig.c	2007-09-18 21:01:37.000000000 +0200
+++ xorg-server/hw/xfree86/common/xf86AutoConfig.c	2007-09-18 21:02:26.000000000 +0200
@@ -49,7 +49,6 @@
 	"\tLoad\t\"dbe\"\n" \
 	"\tLoad\t\"glx\"\n" \
 	"\tLoad\t\"freetype\"\n" \
-	"\tLoad\t\"type1\"\n" \
 	"\tLoad\t\"record\"\n" \
 	"\tLoad\t\"dri\"\n" \
 	"EndSection\n\n"
Index: xorg-server/hw/xfree86/common/xf86Config.h
===================================================================
--- xorg-server.orig/hw/xfree86/common/xf86Config.h	2007-09-18 21:01:37.000000000 +0200
+++ xorg-server/hw/xfree86/common/xf86Config.h	2007-09-18 21:02:26.000000000 +0200
@@ -61,7 +61,6 @@
     {.name = "dbe",      .toLoad = TRUE,    .load_opt=NULL},
     {.name = "glx",      .toLoad = TRUE,    .load_opt=NULL},
     {.name = "freetype", .toLoad = TRUE,    .load_opt=NULL},
-    {.name = "type1",    .toLoad = TRUE,    .load_opt=NULL},
     {.name = "record",   .toLoad = TRUE,    .load_opt=NULL},
     {.name = "dri",      .toLoad = TRUE,    .load_opt=NULL},
     {.name = NULL,       .toLoad = FALSE,   .load_opt=NULL}
Index: xorg-server/hw/xfree86/dixmods/Makefile.am
===================================================================
--- xorg-server.orig/hw/xfree86/dixmods/Makefile.am	2007-09-18 20:57:33.000000000 +0200
+++ xorg-server/hw/xfree86/dixmods/Makefile.am	2007-09-18 21:02:26.000000000 +0200
@@ -40,8 +40,7 @@
                          $(XTRAPMOD)
 
 fontsmoduledir = $(moduledir)/fonts
-fontsmodule_LTLIBRARIES = libfreetype.la \
-                          libtype1.la
+fontsmodule_LTLIBRARIES = libfreetype.la
 
 AM_CFLAGS = @XORG_CFLAGS@ @DIX_CFLAGS@
 INCLUDES = @XORG_INCS@ \
@@ -104,9 +103,6 @@
 libfreetype_la_LDFLAGS = -avoid-version
 libfreetype_la_SOURCES = ftmodule.c
 
-libtype1_la_LDFLAGS = -avoid-version
-libtype1_la_SOURCES = type1mod.c
-
 libdixmods_la_SOURCES = $(top_srcdir)/mi/miinitext.c
 libdixmods_la_CFLAGS = -DXFree86LOADER $(AM_CFLAGS)
 
Index: xorg-server/hw/xfree86/dixmods/type1mod.c
===================================================================
--- xorg-server.orig/hw/xfree86/dixmods/type1mod.c	2007-09-10 14:32:05.000000000 +0200
+++ /dev/null	1970-01-01 00:00:00.000000000 +0000
@@ -1,75 +0,0 @@
-/*
- * Copyright (C) 1998 The XFree86 Project, Inc.  All Rights Reserved.
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to
- * deal in the Software without restriction, including without limitation the
- * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
- * sell copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
- * XFREE86 PROJECT BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
- * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
- * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
- *
- * Except as contained in this notice, the name of the XFree86 Project shall
- * not be used in advertising or otherwise to promote the sale, use or other
- * dealings in this Software without prior written authorization from the
- * XFree86 Project.
- */
-
-#ifdef HAVE_XORG_CONFIG_H
-#include <xorg-config.h>
-#endif
-
-#include "misc.h"
-
-#include <X11/fonts/fontmod.h>
-#include "xf86Module.h"
-
-static MODULESETUPPROTO(type1Setup);
-
-    /*
-     * This is the module data function that is accessed when loading 
-     * libtype1 as a module.
-     */
-
-static XF86ModuleVersionInfo VersRec =
-{
-	"type1",
-	MODULEVENDORSTRING,
-	MODINFOSTRING1,
-	MODINFOSTRING2,
-	XORG_VERSION_CURRENT,
-	1, 0, 2,
-	ABI_CLASS_FONT,			/* Font module */
-	ABI_FONT_VERSION,
-	MOD_CLASS_FONT,
-	{0,0,0,0}       /* signature, to be patched into the file by a tool */
-};
-
-_X_EXPORT XF86ModuleData type1ModuleData = { &VersRec, type1Setup, NULL };
-
-extern void Type1RegisterFontFileFunctions(void);
-
-FontModule type1Module = {
-    Type1RegisterFontFileFunctions,
-    "Type1",
-    NULL
-};
-
-static pointer
-type1Setup(pointer module, pointer opts, int *errmaj, int *errmin)
-{
-    type1Module.module = module;
-    LoadFont(&type1Module);
-
-    /* Need a non-NULL return */
-    return (pointer)1;
-}
Index: xorg-server/hw/xfree86/doc/man/xorg.conf.man.pre
===================================================================
--- xorg-server.orig/hw/xfree86/doc/man/xorg.conf.man.pre	2007-09-18 20:51:46.000000000 +0200
+++ xorg-server/hw/xfree86/doc/man/xorg.conf.man.pre	2007-09-18 21:02:26.000000000 +0200
@@ -700,10 +700,10 @@
 prefix, or the \(lq.a\(rq, \(lq.o\(rq, or \(lq.so\(rq suffixes.
 .PP
 .RS 7
-Example: the Type 1 font rasteriser can be loaded with the following entry:
+Example: the FreeType font rasteriser can be loaded with the following entry:
 .PP
 .RS 4
-.B "Load \*qtype1\*q"
+.B "Load \*qfreetype\*q"
 .RE
 .RE
 .TP 7
