From bb3e734587062f22cf3092eef954f3ad03129d7b Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Sun, 13 Jul 2008 18:41:53 +0930
Subject: [PATCH] Xi: protect against NULL handlers, don't try to dereference.
 (cherry picked from commit e7abe1676a6a4e4249504b8c9660cbad70569199)

---
 Xi/xiproperty.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/Xi/xiproperty.c b/Xi/xiproperty.c
index 0b97328..0ecdeef 100644
--- a/Xi/xiproperty.c
+++ b/Xi/xiproperty.c
@@ -344,7 +344,8 @@ XIChangeDeviceProperty (DeviceIntPtr dev, Atom property, Atom type,
             XIPropertyHandlerPtr handler = dev->properties.handlers;
             while(handler)
             {
-                if (!handler->SetProperty(dev, prop->propertyName, &new_value))
+                if (handler->SetProperty &&
+                    !handler->SetProperty(dev, prop->propertyName, &new_value))
                 {
                     if (new_value.data)
                         xfree (new_value.data);
@@ -410,7 +411,8 @@ XIGetDeviceProperty (DeviceIntPtr dev, Atom property, Bool pending)
             XIPropertyHandlerPtr handler = dev->properties.handlers;
             while(handler)
             {
-                handler->GetProperty(dev, prop->propertyName);
+                if (handler->GetProperty)
+                    handler->GetProperty(dev, prop->propertyName);
                 handler = handler->next;
             }
         }
-- 
1.5.5.1

