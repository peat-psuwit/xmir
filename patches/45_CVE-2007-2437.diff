From 71fc5b3e9309182978ead676965d65ca93a4e3b9 Mon Sep 17 00:00:00 2001
From: Keith Packard <keithp@keithp.com>
Date: Wed, 2 May 2007 11:41:11 +0200
Subject: [PATCH] Fix for a divide by zero that can be triggered by a malicious client.

Problem reported by Derek Abdine of rapid7.com. Thanks.
---
 fb/fbtrap.c         |    3 +++
 render/renderedge.c |    1 +
 2 files changed, 4 insertions(+), 0 deletions(-)

Index: xorg-server/fb/fbtrap.c
===================================================================
--- xorg-server.orig/fb/fbtrap.c	2007-05-09 02:16:04.000000000 +0200
+++ xorg-server/fb/fbtrap.c	2007-05-09 02:27:10.000000000 +0200
@@ -115,6 +115,9 @@
     RenderEdge	l, r;
     xFixed	t, b;
     
+    if (!xTrapezoidValid (trap))
+	return;
+
     fbGetDrawable (pPicture->pDrawable, buf, stride, bpp, pxoff, pyoff);
 
     width = pPicture->pDrawable->width;
Index: xorg-server/render/renderedge.c
===================================================================
--- xorg-server.orig/render/renderedge.c	2007-05-09 02:16:04.000000000 +0200
+++ xorg-server/render/renderedge.c	2007-05-09 02:27:10.000000000 +0200
@@ -143,6 +143,7 @@
     dx = x_bot - x_top;
     dy = y_bot - y_top;
     e->dy = dy;
+    e->dx = 0;
     if (dy)
     {
 	if (dx >= 0)
