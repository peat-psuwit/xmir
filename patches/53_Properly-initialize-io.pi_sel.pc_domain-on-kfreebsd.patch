From 43b9645e4f5343757613c422c9e1204ba826d1f7 Mon Sep 17 00:00:00 2001
From: Petr Salinger <Petr.Salinger@seznam.cz>
Date: Mon, 6 Oct 2008 18:33:31 +0200
Subject: [PATCH] Properly initialize io.pi_sel.pc_domain on kfreebsd

---
 hw/xfree86/os-support/bus/freebsdPci.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/hw/xfree86/os-support/bus/freebsdPci.c b/hw/xfree86/os-support/bus/freebsdPci.c
index 63c00b2..b1f3dbd 100644
--- a/hw/xfree86/os-support/bus/freebsdPci.c
+++ b/hw/xfree86/os-support/bus/freebsdPci.c
@@ -133,6 +133,7 @@ freebsdPciCfgRead(PCITAG tag, int off)
 {
 	struct pci_io io;
 	int error;
+	io.pi_sel.pc_domain = PCI_DOM_FROM_TAG(tag);
 	io.pi_sel.pc_bus = BUS(tag);
 	io.pi_sel.pc_dev = DFN(tag) >> 3;
 	io.pi_sel.pc_func = DFN(tag) & 7;
@@ -148,6 +149,7 @@ static void
 freebsdPciCfgWrite(PCITAG tag, int off, CARD32 val)
 {
 	struct pci_io io;
+	io.pi_sel.pc_domain = PCI_DOM_FROM_TAG(tag);
 	io.pi_sel.pc_bus = BUS(tag);
 	io.pi_sel.pc_dev = DFN(tag) >> 3;
 	io.pi_sel.pc_func = DFN(tag) & 7;
-- 
1.5.6.5

